var QNRtcAiManager=function(){function e(){}return e.set=function(e,t){this.cache[e]=t},e.get=function(e){return this.cache[e]},e.init=function(e,t){this.set("token",e),this.set("signCallback",t)},e.cache={},e}(),extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function __rest(e,t){var o={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(o[r[n]]=e[r[n]]);return o}function __awaiter(e,a,c,s){return new(c=c||Promise)(function(o,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function r(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?o(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,r)}i((s=s.apply(e,a||[])).next())})}function __generator(n,r){var i,a,c,s={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(o){return function(e){var t=[o,e];if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,a&&(c=2&t[0]?a.return:t[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,t[1])).done)return c;switch(a=0,(t=c?[2&t[0],c.value]:t)[0]){case 0:case 1:c=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(c=0<(c=s.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3])){s.label=t[1];break}if(6===t[0]&&s.label<c[1]){s.label=c[1],c=t;break}if(c&&s.label<c[2]){s.label=c[2],s.ops.push(t);break}c[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],a=0}finally{i=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function __spreadArray(e,t){for(var o=0,n=t.length,r=e.length;o<n;o++,r++)e[r]=t[o];return e}var ConnectStatus,QNAudioToTextStatus,defaultQuery={voice_type:1,voice_encode:1,voice_sample:16e3,needvad:1,need_partial:1,maxsil:10,need_words:0,model_type:0,voice_id:void 0,force_final:0,vad_sil_thres:.5},TranslateWebSocket=(!function(e){e[e.CLOSED=0]="CLOSED",e[e.PROCESSING=1]="PROCESSING",e[e.OPENED=2]="OPENED"}(ConnectStatus=ConnectStatus||{}),function(){function e(e,t){this.status=ConnectStatus.CLOSED;var o=e.query,o=void 0===o?defaultQuery:o,e=e.baseUrl,e=void 0===e?"wss://wz-rt-asr.service-z0.qiniuapp.com/asr":e,o=Object.entries(__assign(__assign(__assign({},defaultQuery),o),{e:Math.floor(Date.now()/1e3)})).filter(function(e){return void 0!==e[1]&&null!==e[1]}).map(function(e){var t=e[0],e=e[1];return"".concat(t,"=").concat(e)}).join("&"),e=e+"?"+encodeURI(o);this.listeners=[],this.initWebSocket(e,t)}return e.prototype.initWebSocket=function(r,i){return __awaiter(this,void 0,void 0,function(){var t,o,n=this;return __generator(this,function(e){switch(e.label){case 0:return this.status=ConnectStatus.PROCESSING,(t=QNRtcAiManager.get("signCallback"))?[4,t(r)]:[3,2];case 1:return o=e.sent(),[3,3];case 2:o=null,e.label=3;case 3:return t=o,this.ws=new WebSocket(r+"&token=".concat(t)),this.on("open",function(){console.info("roomlog websocket open"),n.status=ConnectStatus.OPENED,i&&i()}),this.on("close",function(){console.info("roomlog websocket close"),n.status=ConnectStatus.CLOSED}),[2]}})})},e.prototype.on=function(e,t){var o;this.listeners.push({event:e,callback:t}),null!==(o=this.ws)&&void 0!==o&&o.addEventListener(e,t)},e.prototype.send=function(e){var t;this.status===ConnectStatus.OPENED&&null!==(t=this.ws)&&void 0!==t&&t.send(e)},e.prototype.sendEOS=function(){this.ws&&this.status===ConnectStatus.OPENED&&this.send("EOS")},e.prototype.close=function(){var e;this.ws&&this.status===ConnectStatus.OPENED&&(this.status=ConnectStatus.CLOSED,null!==(e=this.ws)&&void 0!==e&&e.close())},e.prototype.destroy=function(){var n=this;this.listeners.map(function(e){var t,o=e.event,e=e.callback;null!==(t=n.ws)&&void 0!==t&&t.removeEventListener(o,e)})},e}()),defaultAudioToTextParams=(!function(e){e[e.AVAILABLE=0]="AVAILABLE",e[e.DESTROY=1]="DESTROY",e[e.ERROR=2]="ERROR",e[e.DETECTING=3]="DETECTING"}(QNAudioToTextStatus=QNAudioToTextStatus||{}),{voice_type:1,voice_encode:1,voice_sample:16e3,needvad:1,need_partial:1,maxsil:10,need_words:0,model_type:0,voice_id:void 0,force_final:0,vad_sil_thres:.5}),QNAudioToTextAnalyzer=function(){function e(){this.status=QNAudioToTextStatus.AVAILABLE,this.isRecording=!1,this.startTime=Date.now(),this.leftDataList=[],this.rightDataList=[]}return e.prototype.startConnectWebSocket=function(t,e){var o=this,n=e.params,r=e.callback,e=e.audioBuffer,e=__assign(__assign(__assign({},defaultAudioToTextParams),{voice_sample:e.sampleRate}),n);t.ws=new TranslateWebSocket({query:e},function(){var e;t.isRecording=!0,t.status=QNAudioToTextStatus.DETECTING,null!==(e=t.ws)&&void 0!==e&&e.on("message",function(e){var e=JSON.parse(e.data);null!=r&&r.onAudioToText&&r.onAudioToText(e),1===e.ended&&(o.timeoutWebSocketCloseJob&&clearTimeout(o.timeoutWebSocketCloseJob),null!==(e=t.ws)&&void 0!==e&&e.close())}),null!=r&&r.onStatusChange&&r.onStatusChange(t.status,"正在实时转化"),null!==(e=t.ws)&&void 0!==e&&e.on("error",function(){t.isRecording=!1,t.status=QNAudioToTextStatus.ERROR,null!=r&&r.onStatusChange&&r.onStatusChange(t.status,"连接异常断线")}),null!==(e=t.ws)&&void 0!==e&&e.on("close",function(){t.isRecording=!1,t.status=QNAudioToTextStatus.DESTROY,null!=r&&r.onStatusChange&&r.onStatusChange(t.status,"已经销毁不可用")})}),t.ws.on("open",function(){var e;console.log("on open"),t.isRecording=!0,t.status=QNAudioToTextStatus.DETECTING,null!==(e=t.ws)&&void 0!==e&&e.on("message",function(e){null!=r&&r.onAudioToText&&r.onAudioToText(JSON.parse(e.data))}),null!=r&&r.onStatusChange&&r.onStatusChange(t.status,"正在实时转化")})},e.prototype.sendMessageToWebSocket=function(e,t){var o,t=t.audioBuffer;e.leftDataList.push(t.getChannelData(0).slice(0)),200<=Date.now()-e.startTime&&(t=this.mergeArray(e.leftDataList),t=Int16Array.from(t.map(function(e){return 0<e?32767*e:32768*e})).buffer,null!==(o=e.ws)&&void 0!==o&&o.send(t),e.startTime=Date.now(),e.leftDataList=[],e.rightDataList=[])},e.prototype.mergeArray=function(e){for(var t=e.length*e[0].length,o=new Float32Array(t),n=0,r=0;r<e.length;r++)o.set(e[r],n),n+=e[r].length;return o},e.startAudioToText=function(e,o,n){function t(e){var t;r.ws||r.startConnectWebSocket(r,{params:o,callback:n,audioBuffer:e}),(null===(t=r.ws)||void 0===t?void 0:t.status)===ConnectStatus.OPENED&&r.sendMessageToWebSocket(r,{audioBuffer:e})}var r=new this;r.startTime=Date.now();return e.on("audioFrame",t),r.audioBufferHandler=t,r.audioTrack=e,r},e.prototype.getStatus=function(){return this.status},e.prototype.stopAudioToText=function(){var e;this.audioTrack&&this.audioBufferHandler&&this.audioTrack.off("audioBuffer",this.audioBufferHandler),null!==(e=this.ws)&&void 0!==e&&e.sendEOS(),this.timeoutJob()},e.prototype.timeoutJob=function(e){var t=this;this.timeoutWebSocketCloseJob=setTimeout(function(){var e;null!==(e=t.ws)&&void 0!==e&&e.close()},e||500)},e}(),doraSDKApiURL="https://ap-open-z0.qiniuapi.com/dora-sdk/api";function post(e,t){var o=t.debug,t=__rest(t,["debug"]),o=o?{request:t||{},debug:o}:{request:t||{}};return fetch(doraSDKApiURL+e,{headers:{Authorization:QNRtcAiManager.get("token"),"Content-Type":"application/json"},body:JSON.stringify(o),method:"POST"}).then(function(e){return e.json()})}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},conversion={exports:{}},imageConversion=(!function(){function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var o,n;conversion.exports=(o=[function(n,e,t){var f;function p(t){return["image/png","image/jpeg","image/gif"].some(e=>e===t)}t.r(e),t.d(e,"canvastoDataURL",function(){return g}),t.d(e,"canvastoFile",function(){return i}),t.d(e,"dataURLtoFile",function(){return m}),t.d(e,"dataURLtoImage",function(){return v}),t.d(e,"downloadFile",function(){return a}),t.d(e,"filetoDataURL",function(){return y}),t.d(e,"imagetoCanvas",function(){return w}),t.d(e,"urltoBlob",function(){return u}),t.d(e,"urltoImage",function(){return d}),t.d(e,"compress",function(){return l}),t.d(e,"compressAccurately",function(){return h}),t.d(e,"EImageType",function(){return f}),(t=f=f||{}).PNG="image/png",t.JPEG="image/jpeg",t.GIF="image/gif";var r=function(e,a,c,s){return new(c=c||Promise)(function(o,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function r(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?o(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,r)}i((s=s.apply(e,a||[])).next())})};function g(e,t=.92,o=f.JPEG){return r(this,void 0,void 0,function*(){return p(o)||(o=f.JPEG),e.toDataURL(o,t)})}function i(e,o=.92,n=f.JPEG){return new Promise(t=>e.toBlob(e=>t(e),n,o))}var c=function(e,a,c,s){return new(c=c||Promise)(function(o,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function r(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?o(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,r)}i((s=s.apply(e,a||[])).next())})};function m(i,a){return c(this,void 0,void 0,function*(){const e=i.split(",");let t=e[0].match(/:(.*?);/)[1];const o=atob(e[1]);let n=o.length;const r=new Uint8Array(n);for(;n--;)r[n]=o.charCodeAt(n);return p(a)&&(t=a),new Blob([r],{type:t})})}function v(n){return new Promise((e,t)=>{const o=new Image;o.onload=()=>e(o),o.onerror=()=>t(new Error("dataURLtoImage(): dataURL is illegal")),o.src=n})}function a(e,t){const o=document.createElement("a"),n=(o.href=window.URL.createObjectURL(e),o.download=t||Date.now().toString(36),document.body.appendChild(o),document.createEvent("MouseEvents"));n.initEvent("click",!1,!1),o.dispatchEvent(n),document.body.removeChild(o)}function y(o){return new Promise(t=>{const e=new FileReader;e.onloadend=e=>t(e.target.result),e.readAsDataURL(o)})}var s=function(e,a,c,s){return new(c=c||Promise)(function(o,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function r(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?o(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,r)}i((s=s.apply(e,a||[])).next())})};function w(i,a={}){return s(this,void 0,void 0,function*(){const t=Object.assign({},a),e=document.createElement("canvas"),o=e.getContext("2d");let n,r;for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=Number(t[i]));if(t.scale){const a=0<t.scale&&t.scale<10?t.scale:1;r=i.width*a,n=i.height*a}else r=t.width||t.height*i.width/i.height||i.width,n=t.height||t.width*i.height/i.width||i.height;switch([5,6,7,8].some(e=>e===t.orientation)?(e.height=r,e.width=n):(e.height=n,e.width=r),t.orientation){case 3:o.rotate(180*Math.PI/180),o.drawImage(i,-e.width,-e.height,e.width,e.height);break;case 6:o.rotate(90*Math.PI/180),o.drawImage(i,0,-e.width,e.height,e.width);break;case 8:o.rotate(270*Math.PI/180),o.drawImage(i,-e.height,0,e.height,e.width);break;case 2:o.translate(e.width,0),o.scale(-1,1),o.drawImage(i,0,0,e.width,e.height);break;case 4:o.translate(e.width,0),o.scale(-1,1),o.rotate(180*Math.PI/180),o.drawImage(i,-e.width,-e.height,e.width,e.height);break;case 5:o.translate(e.width,0),o.scale(-1,1),o.rotate(90*Math.PI/180),o.drawImage(i,0,-e.width,e.height,e.width);break;case 7:o.translate(e.width,0),o.scale(-1,1),o.rotate(270*Math.PI/180),o.drawImage(i,-e.height,0,e.height,e.width);break;default:o.drawImage(i,0,0,e.width,e.height)}return e})}function u(e){return fetch(e).then(e=>e.blob())}function d(n){return new Promise((e,t)=>{const o=new Image;o.onload=()=>e(o),o.onerror=()=>t(new Error("urltoImage(): Image failed to load, please check the image URL")),o.src=n})}var o=function(e,a,c,s){return new(c=c||Promise)(function(o,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function r(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?o(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,r)}i((s=s.apply(e,a||[])).next())})};function l(r,i={}){return o(this,void 0,void 0,function*(){if(!(r instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");if((i="object"!=typeof i?Object.assign({quality:i}):i).quality=Number(i.quality),Number.isNaN(i.quality))return r;const e=yield y(r);let t=e.split(",")[0].match(/:(.*?);/)[1],o=f.JPEG;p(i.type)&&(o=i.type,t=i.type);var n=yield m(yield g(yield w(yield v(e),Object.assign({},i)),i.quality,o),t);return n.size>r.size?r:n})}function h(l,h={}){return o(this,void 0,void 0,function*(){if(!(l instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");if((h="object"!=typeof h?Object.assign({size:h}):h).size=Number(h.size),Number.isNaN(h.size))return l;if(1024*h.size>l.size)return l;h.accuracy=Number(h.accuracy),(!h.accuracy||h.accuracy<.8||.99<h.accuracy)&&(h.accuracy=.95);const t=h.size*(2-h.accuracy)*1024,o=1024*h.size,n=h.size*h.accuracy*1024,e=yield y(l);let r=e.split(",")[0].match(/:(.*?);/)[1],i=f.JPEG;p(h.type)&&(i=h.type,r=h.type);var d=yield w(yield v(e),Object.assign({},h));let a,c=.5;const s=[null,null];for(let e=1;e<=7;e++){const h=.75*(a=yield g(d,c,i)).length;if(7===e){(t<h||n>h)&&(a=[a,...s].filter(e=>e).sort((e,t)=>Math.abs(.75*e.length-o)-Math.abs(.75*t.length-o))[0]);break}if(t<h)s[1]=a,c-=Math.pow(.5,e+1);else{if(!(n>h))break;s[0]=a,c+=Math.pow(.5,e+1)}}var u=yield m(a,r);return u.size>l.size?l:u})}}],n={},r.m=o,r.c=n,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0))}(),conversion.exports);function compress(a,c){return new Promise(function(r){var i=new Image;i.src=a,i.onload=function(){var e,t,o=c.maxWidth,n=c.maxHeight;i.width*i.height>=o*n?(e=document.createElement("canvas"),o=Math.max(i.width/o,i.height/n),n=i.width/o,o=i.height/o,e.setAttribute("width",n+""),e.setAttribute("height",o+""),null!==(t=e.getContext("2d"))&&void 0!==t&&t.drawImage(i,0,0,n,o),t=e.toDataURL("image/png"),r(t)):r(a)}})}function dataURLToFile(e,t){for(var e=e.split(","),o=e[0].match(/:(.*?);/)[1],n=atob(e[1]),r=n.length,i=new Uint8Array(r);r--;)i[r]=n.charCodeAt(r);return new File([i],t,{type:o})}function blobToBase64(o){return new Promise(function(e){var t=new FileReader;t.readAsDataURL(o),t.onload=function(){e(t.result)}})}var QNAuthoritativeFaceComparer=function(){function e(){}return e.run=function(e,t){e=dataURLToFile(e.getCurrentFrameData(),"photo");return imageConversion.compressAccurately(e,24).then(function(e){return blobToBase64(e)}).then(function(e){return post("/face-hdphotoauth",__assign({photo_b64:e.split(",")[1]},t))})},e}();function blobToDataURI(e){return new Promise(function(t,o){var n=new FileReader;n.onload=function(e){t(e.target.result+"")},n.onerror=function(e){o("Failed to read file!\n\n"+n.error)},n.readAsDataURL(e)})}var QNRTCError=function(n){function e(e,t){var o=n.call(this,t)||this;return o.code=e,o.error=t,o}return __extends(e,n),e}(Error),NOT_SUPPORT_ERROR=function(e){return new QNRTCError(11008,"not support! ".concat(e))},UNEXPECTED_ERROR=function(e){return new QNRTCError(11e3,"piliRTC: unexpected error ".concat(e))},LogModel=function(){function e(e){this.level=e}return e.prototype.setLevel=function(e){this.level=e},e.prototype.log=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];"log"===this.level&&(e="".concat(getLogTimeString()," %cLOG-QNRTC"),console.info.apply(console,__spreadArray([e,"color: #66ccff; font-weight: bold;"],t)))},e.prototype.debug=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];"log"!==this.level&&"debug"!==this.level||(e="".concat(getLogTimeString()," %cDEBUG-QNRTC"),console.info.apply(console,__spreadArray([e,"color: #A28148; font-weight: bold;"],t)))},e.prototype.warning=function(){for(var e,t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];"disable"!==this.level&&(e="".concat(getLogTimeString()," %cWARNING-QNRTC"),console.warn.apply(console,__spreadArray([e,"color: #E44F44; font-weight: bold;"],t)))},e}();function getLogTimeString(){var e=new Date;function t(e){e=e.toString();return e.length<2?"0"+e:e}var o=t(e.getHours()),n=t(e.getMinutes()),r=t(e.getSeconds()),e=e.getMilliseconds();return"[".concat(o,":").concat(n,":").concat(r,".").concat(e,"]")}var QNFaceAction,QNVideoType,QNSpeaker,QNAudioEncoding,log=new LogModel("log"),QNMediaRecorder=function(){function a(){this.recordedChunks=[]}return a.prototype.releaseMediaElement=function(){log.log("Recorder release Media Element",this.mediaElement),this.mediaElement&&this.mediaElement.parentElement&&this.mediaElement.parentElement.removeChild(this.mediaElement)},a.prototype.release=function(){this.recorder&&"inactive"!==this.recorder.state&&this.recorder.stop(),this.recorder=void 0,this.recordedChunks=[],this.recordedBlob=void 0,this.recordedUrl&&(window.URL.revokeObjectURL(this.recordedUrl),this.recordedUrl=void 0),this.releaseMediaElement()},a.prototype.setMimeType=function(e){if(log.log("Recorder setMimeType, ",e),!("MediaRecorder"in window))throw NOT_SUPPORT_ERROR("MediaRecorder is not supported.");return!!window.MediaRecorder.isTypeSupported(e)&&(this.mimeType=e,!0)},a.prototype.start=function(e){var t=this;if(log.log("Recorder start, ",e),!("MediaRecorder"in window))throw NOT_SUPPORT_ERROR("MediaRecorder is not supported.");if(void 0===e||!e.audioTrack&&!e.videoTrack)throw UNEXPECTED_ERROR("Invalid parameters.");if(this.recorder&&"inactive"!==this.recorder.state)throw UNEXPECTED_ERROR("MediaRecorder is active, cannot start again.");this.release();try{var o,n=[],r=(e.audioTrack&&n.push(e.audioTrack.getMediaStreamTrack()),e.videoTrack&&n.push(e.videoTrack.getMediaStreamTrack()),new MediaStream(n)),i=window;this.mimeType?(o={mimeType:this.mimeType},this.recorder=new i.MediaRecorder(r,o)):this.recorder=new i.MediaRecorder(r),this.recorder.ondataavailable=function(e){log.debug("Recorder data, ",e.data),t.recordedChunks.push(e.data)},this.recorder.start(a.recorderTimeslice)}catch(e){throw UNEXPECTED_ERROR("MediaRecoder start error: "+e.message)}},a.prototype.pause=function(){if(log.log("Recorder pause"),!this.recorder)throw UNEXPECTED_ERROR("No MediaRecorder, please try to start first.");if("recording"!==this.recorder.state)throw UNEXPECTED_ERROR("MediaRecorder is not in recording state, cannot do pause.");this.recorder.pause()},a.prototype.resume=function(){if(log.log("Recorder resume"),!this.recorder)throw UNEXPECTED_ERROR("No MediaRecorder, please try to start first.");if("paused"!==this.recorder.state)throw UNEXPECTED_ERROR("MediaRecorder is not in paused state, cannot do resume.");this.recorder.resume()},a.prototype.stop=function(){if(log.log("Recorder stop, ",this.recordedChunks),!this.recorder)throw UNEXPECTED_ERROR("No MediaRecorder, please try to start first.");if("inactive"===this.recorder.state)throw UNEXPECTED_ERROR("MediaRecorder is in inactive state, cannot do stop.");try{var e;return this.recorder.stop(),this.mimeType?(e={type:this.mimeType},this.recordedBlob=new Blob(this.recordedChunks,e)):this.recordedBlob=new Blob(this.recordedChunks),this.recordedUrl=window.URL.createObjectURL(this.recordedBlob),this.recordedBlob}catch(e){throw UNEXPECTED_ERROR("MediaRecorder stop error: "+e.message)}},a.prototype.play=function(e,t){if(log.log("Recorder play, ",e,t=void 0===t?!0:t),!this.recordedUrl)throw UNEXPECTED_ERROR("No recorded data, please start record first.");this.releaseMediaElement();var n=document.createElement("video");return n.style.width="100%",n.style.height="100%",n.style.objectFit="contain",n.controls=!0,n.muted=t,n.className="qnrtc-recorder-video-player",n.setAttribute("playsinline",!0),n.autoplay=!0,n.src=this.recordedUrl,e.appendChild(n),this.mediaElement=n,new Promise(function(e,t){var o;try{o=n.play()}catch(e){t(e)}o?o.then(e).catch(function(e){t(e);try{throw UNEXPECTED_ERROR("MediaRecoder play error: "+e.message)}catch(e){}}):e()})},a.prototype.download=function(e){if(log.log("Recorder download, "+e),!this.recordedUrl)throw UNEXPECTED_ERROR("No recorded data, please start record first.");var t=document.createElement("a");t.style.display="none",t.href=this.recordedUrl,t.download=e,document.body.appendChild(t),t.click(),setTimeout(function(){document.body.removeChild(t)},100)},a.recorderTimeslice=200,a}(),QNFaceActionLive=(!function(e){e.Nod="nod",e.Shake="shake",e.Blink="blink",e.Mouth="mouth"}(QNFaceAction=QNFaceAction||{}),function(e){e[e.Mp4=1]="Mp4",e[e.H264=2]="H264"}(QNVideoType=QNVideoType||{}),function(){function e(){}return e.start=function(e,t){var o,n=new this,r=((o={})[QNVideoType.Mp4]="video/mp4",o[QNVideoType.H264]="video/webm;codecs=h264",new QNMediaRecorder);return r.setMimeType(o[n.video_type]),n.recorder=r,n.recorder.start({videoTrack:e}),n.params=t,n},e.prototype.commit=function(){return __awaiter(this,void 0,void 0,function(){var t,o;return __generator(this,function(e){switch(e.label){case 0:return[4,blobToDataURI(this.recorder.stop())];case 1:return o=e.sent(),t="base64,",t=o.indexOf(t)+t.length,o=o.slice(t),[2,post("/face-actlive",__assign({video_b64:o},this.params))]}})})},e}()),QNAuthorityActionFaceComparer=function(){function e(){}return e.start=function(e,t,o){var n=new this;return n.faceActionLiveDetector=QNFaceActionLive.start(e,t),n.authoritativeFaceParams=o,n.videoTrack=e,n},e.prototype.commit=function(){return Promise.all([this.faceActionLiveDetector.commit(),QNAuthoritativeFaceComparer.run(this.videoTrack,this.authoritativeFaceParams)]).then(function(e){return{faceActionResult:e[0],authoritativeFaceResult:e[1]}})},e}(),QNFaceComparer=function(){function e(){}return e.run=function(e,t,o){e=e.getCurrentFrameData();return post("/face-compare",__assign({data_uri_a:e,data_uri_b:t},o))},e}(),QNFaceDetector=function(){function e(){}return e.run=function(e,t){e=e.getCurrentFrameData();return post("/face-detect",__assign({image_b64:e.replace("data:image/png;base64,","")},t))},e}(),QNFaceFlashLiveDetector=function(){function e(){}return e.start=function(t,e){var e=e||15,o=new this;return o.frameRate=e,o.videoData=[],o.timer=setInterval(function(){var e=t.getCurrentFrameData().replace("data:image/png;base64,","");o.videoData.push({image:e})},1e3/e),o},e.prototype.commit=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return clearInterval(this.timer),[2,post("/face-flashlive",{video_data:this.videoData})]})})},e}(),QNIDCardDetector=function(){function e(){}return e.run=function(e,t){e=e.getCurrentFrameData();return post("/ocr-idcard",__assign({image:e.replace("data:image/png;base64,","")},t))},e}(),QNOCRDetector=function(){function e(){}return e.run=function(e){return post("/general-ocr",{"data.uri":"data:application/octet-stream;base64,"+e.getCurrentFrameData().split(",")[1]})},e}(),QNTextToSpeakAnalyzer=(!function(e){e.Male1="male1",e.Male2="male2",e.Female3="female3",e.Male4="male4",e.Female5="female5",e.Female6="female6",e.Kefu1="kefu1",e.Girl1="girl1"}(QNSpeaker=QNSpeaker||{}),function(e){e.Wav="wav",e.Pcm="pcm",e.Mp3="mp3"}(QNAudioEncoding=QNAudioEncoding||{}),function(){function e(){}return e.run=function(e){return post("/voice-tts",__assign({speaker:QNSpeaker.Kefu1,audio_encoding:QNAudioEncoding.Wav,sample_rate:16e3,volume:50,speed:0},e))},e}()),version="4.0.0";export{QNAudioToTextAnalyzer,QNAuthoritativeFaceComparer,QNAuthorityActionFaceComparer,QNFaceActionLive,QNFaceComparer,QNFaceDetector,QNFaceFlashLiveDetector,QNIDCardDetector,QNMediaRecorder,QNOCRDetector,QNRtcAiManager,QNTextToSpeakAnalyzer,blobToBase64,compress,dataURLToFile,version};
