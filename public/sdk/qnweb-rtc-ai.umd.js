!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).QNRTCAI={})}(this,function(e){"use strict";d.set=function(e,t){this.cache[e]=t},d.get=function(e){return this.cache[e]},d.init=function(e,t){this.set("token",e),this.set("signCallback",t)},d.cache={};var l=d;function d(){}var h=function(e,t){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};var i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function f(e,a,c,s){return new(c=c||Promise)(function(r,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function o(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,o)}i((s=s.apply(e,a||[])).next())})}function p(n,o){var i,a,c,s={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(r){return function(e){var t=[r,e];if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,a&&(c=2&t[0]?a.return:t[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,t[1])).done)return c;switch(a=0,(t=c?[2&t[0],c.value]:t)[0]){case 0:case 1:c=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(c=0<(c=s.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3])){s.label=t[1];break}if(6===t[0]&&s.label<c[1]){s.label=c[1],c=t;break}if(c&&s.label<c[2]){s.label=c[2],s.ops.push(t);break}c[2]&&s.ops.pop(),s.trys.pop();continue}t=o.call(n,s)}catch(e){t=[6,e],a=0}finally{i=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function m(e,t){for(var r=0,n=t.length,o=e.length;r<n;r++,o++)e[o]=t[r];return e}var a,v,g={voice_type:1,voice_encode:1,voice_sample:16e3,needvad:1,need_partial:1,maxsil:10,need_words:0,model_type:0,voice_id:void 0,force_final:0,vad_sil_thres:.5},w=((t=a=a||{})[t.CLOSED=0]="CLOSED",t[t.PROCESSING=1]="PROCESSING",t[t.OPENED=2]="OPENED",y.prototype.initWebSocket=function(o,i){return f(this,void 0,void 0,function(){var t,r,n=this;return p(this,function(e){switch(e.label){case 0:return this.status=a.PROCESSING,(t=l.get("signCallback"))?[4,t(o)]:[3,2];case 1:return r=e.sent(),[3,3];case 2:r=null,e.label=3;case 3:return t=r,this.ws=new WebSocket(o+"&token=".concat(t)),this.on("open",function(){console.info("roomlog websocket open"),n.status=a.OPENED,i&&i()}),this.on("close",function(){console.info("roomlog websocket close"),n.status=a.CLOSED}),[2]}})})},y.prototype.on=function(e,t){var r;this.listeners.push({event:e,callback:t}),null!==(r=this.ws)&&void 0!==r&&r.addEventListener(e,t)},y.prototype.send=function(e){var t;this.status===a.OPENED&&null!==(t=this.ws)&&void 0!==t&&t.send(e)},y.prototype.sendEOS=function(){this.ws&&this.status===a.OPENED&&this.send("EOS")},y.prototype.close=function(){var e;this.ws&&this.status===a.OPENED&&(this.status=a.CLOSED,null!==(e=this.ws)&&void 0!==e&&e.close())},y.prototype.destroy=function(){var n=this;this.listeners.map(function(e){var t,r=e.event,e=e.callback;null!==(t=n.ws)&&void 0!==t&&t.removeEventListener(r,e)})},y);function y(e,t){this.status=a.CLOSED;var r=e.query,r=void 0===r?g:r,e=e.baseUrl,e=void 0===e?"wss://ap-open-ws.service-z0.qiniuapp.com/asr":e,r=Object.entries(i(i(i({},g),r),{e:Math.floor(Date.now()/1e3)})).filter(function(e){return void 0!==e[1]&&null!==e[1]}).map(function(e){var t=e[0],e=e[1];return"".concat(t,"=").concat(e)}).join("&"),e=e+"?"+encodeURI(r);this.listeners=[],this.initWebSocket(e,t)}(t=v=v||{})[t.AVAILABLE=0]="AVAILABLE",t[t.DESTROY=1]="DESTROY",t[t.ERROR=2]="ERROR",t[t.DETECTING=3]="DETECTING";var b={voice_type:1,voice_encode:1,voice_sample:16e3,needvad:1,need_partial:1,maxsil:10,need_words:0,model_type:0,voice_id:void 0,force_final:0,vad_sil_thres:.5},t=(r.prototype.startConnectWebSocket=function(t,e){var r=this,n=e.params,o=e.callback,e=e.audioBuffer,e=i(i(i({},b),{voice_sample:e.sampleRate}),n);t.ws=new w({query:e},function(){var e;t.isRecording=!0,t.status=v.DETECTING,null!==(e=t.ws)&&void 0!==e&&e.on("message",function(e){var e=JSON.parse(e.data);null!=o&&o.onAudioToText&&o.onAudioToText(e),1===e.ended&&(r.timeoutWebSocketCloseJob&&clearTimeout(r.timeoutWebSocketCloseJob),null!==(e=t.ws)&&void 0!==e&&e.close())}),null!=o&&o.onStatusChange&&o.onStatusChange(t.status,"正在实时转化"),null!==(e=t.ws)&&void 0!==e&&e.on("error",function(){t.isRecording=!1,t.status=v.ERROR,null!=o&&o.onStatusChange&&o.onStatusChange(t.status,"连接异常断线")}),null!==(e=t.ws)&&void 0!==e&&e.on("close",function(){t.isRecording=!1,t.status=v.DESTROY,null!=o&&o.onStatusChange&&o.onStatusChange(t.status,"已经销毁不可用")})}),t.ws.on("open",function(){var e;console.log("on open"),t.isRecording=!0,t.status=v.DETECTING,null!==(e=t.ws)&&void 0!==e&&e.on("message",function(e){null!=o&&o.onAudioToText&&o.onAudioToText(JSON.parse(e.data))}),null!=o&&o.onStatusChange&&o.onStatusChange(t.status,"正在实时转化")})},r.prototype.sendMessageToWebSocket=function(e,t){var r,t=t.audioBuffer;e.leftDataList.push(t.getChannelData(0).slice(0)),200<=Date.now()-e.startTime&&(t=this.mergeArray(e.leftDataList),t=Int16Array.from(t.map(function(e){return 0<e?32767*e:32768*e})).buffer,null!==(r=e.ws)&&void 0!==r&&r.send(t),e.startTime=Date.now(),e.leftDataList=[],e.rightDataList=[])},r.prototype.mergeArray=function(e){for(var t=e.length*e[0].length,r=new Float32Array(t),n=0,o=0;o<e.length;o++)r.set(e[o],n),n+=e[o].length;return r},r.startAudioToText=function(e,r,n){function t(e){var t;o.ws||o.startConnectWebSocket(o,{params:r,callback:n,audioBuffer:e}),(null===(t=o.ws)||void 0===t?void 0:t.status)===a.OPENED&&o.sendMessageToWebSocket(o,{audioBuffer:e})}var o=new this;o.startTime=Date.now();return e.on("audioFrame",t),o.audioBufferHandler=t,o.audioTrack=e,o},r.prototype.getStatus=function(){return this.status},r.prototype.stopAudioToText=function(){var e;this.audioTrack&&this.audioBufferHandler&&this.audioTrack.off("audioBuffer",this.audioBufferHandler),null!==(e=this.ws)&&void 0!==e&&e.sendEOS(),this.timeoutJob()},r.prototype.timeoutJob=function(e){var t=this;this.timeoutWebSocketCloseJob=setTimeout(function(){var e;null!==(e=t.ws)&&void 0!==e&&e.close()},e||500)},r);function r(){this.status=v.AVAILABLE,this.isRecording=!1,this.startTime=Date.now(),this.leftDataList=[],this.rightDataList=[]}function E(e,t){var r=t.debug,t=function(e,t){var r={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]]);return r}(t,["debug"]),r=r?{request:t||{},debug:r}:{request:t||{}};return fetch("https://ap-open-z0.qiniuapi.com/dora-sdk/api"+e,{headers:{Authorization:l.get("token"),"Content-Type":"application/json"},body:JSON.stringify(r),method:"POST"}).then(function(e){return e.json()})}var R,T;function o(e){if(T[e])return T[e].exports;var t=T[e]={i:e,l:!1,exports:{}};return R[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}R=[function(n,e,t){var f;function p(t){return["image/png","image/jpeg","image/gif"].some(e=>e===t)}t.r(e),t.d(e,"canvastoDataURL",function(){return m}),t.d(e,"canvastoFile",function(){return i}),t.d(e,"dataURLtoFile",function(){return v}),t.d(e,"dataURLtoImage",function(){return g}),t.d(e,"downloadFile",function(){return a}),t.d(e,"filetoDataURL",function(){return w}),t.d(e,"imagetoCanvas",function(){return y}),t.d(e,"urltoBlob",function(){return u}),t.d(e,"urltoImage",function(){return l}),t.d(e,"compress",function(){return d}),t.d(e,"compressAccurately",function(){return h}),t.d(e,"EImageType",function(){return f}),(t=f=f||{}).PNG="image/png",t.JPEG="image/jpeg",t.GIF="image/gif";var o=function(e,a,c,s){return new(c=c||Promise)(function(r,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function o(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,o)}i((s=s.apply(e,a||[])).next())})};function m(e,t=.92,r=f.JPEG){return o(this,void 0,void 0,function*(){return p(r)||(r=f.JPEG),e.toDataURL(r,t)})}function i(e,r=.92,n=f.JPEG){return new Promise(t=>e.toBlob(e=>t(e),n,r))}var c=function(e,a,c,s){return new(c=c||Promise)(function(r,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function o(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,o)}i((s=s.apply(e,a||[])).next())})};function v(i,a){return c(this,void 0,void 0,function*(){const e=i.split(",");let t=e[0].match(/:(.*?);/)[1];const r=atob(e[1]);let n=r.length;const o=new Uint8Array(n);for(;n--;)o[n]=r.charCodeAt(n);return p(a)&&(t=a),new Blob([o],{type:t})})}function g(n){return new Promise((e,t)=>{const r=new Image;r.onload=()=>e(r),r.onerror=()=>t(new Error("dataURLtoImage(): dataURL is illegal")),r.src=n})}function a(e,t){const r=document.createElement("a"),n=(r.href=window.URL.createObjectURL(e),r.download=t||Date.now().toString(36),document.body.appendChild(r),document.createEvent("MouseEvents"));n.initEvent("click",!1,!1),r.dispatchEvent(n),document.body.removeChild(r)}function w(r){return new Promise(t=>{const e=new FileReader;e.onloadend=e=>t(e.target.result),e.readAsDataURL(r)})}var s=function(e,a,c,s){return new(c=c||Promise)(function(r,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function o(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,o)}i((s=s.apply(e,a||[])).next())})};function y(i,a={}){return s(this,void 0,void 0,function*(){const t=Object.assign({},a),e=document.createElement("canvas"),r=e.getContext("2d");let n,o;for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=Number(t[i]));if(t.scale){const a=0<t.scale&&t.scale<10?t.scale:1;o=i.width*a,n=i.height*a}else o=t.width||t.height*i.width/i.height||i.width,n=t.height||t.width*i.height/i.width||i.height;switch([5,6,7,8].some(e=>e===t.orientation)?(e.height=o,e.width=n):(e.height=n,e.width=o),t.orientation){case 3:r.rotate(180*Math.PI/180),r.drawImage(i,-e.width,-e.height,e.width,e.height);break;case 6:r.rotate(90*Math.PI/180),r.drawImage(i,0,-e.width,e.height,e.width);break;case 8:r.rotate(270*Math.PI/180),r.drawImage(i,-e.height,0,e.height,e.width);break;case 2:r.translate(e.width,0),r.scale(-1,1),r.drawImage(i,0,0,e.width,e.height);break;case 4:r.translate(e.width,0),r.scale(-1,1),r.rotate(180*Math.PI/180),r.drawImage(i,-e.width,-e.height,e.width,e.height);break;case 5:r.translate(e.width,0),r.scale(-1,1),r.rotate(90*Math.PI/180),r.drawImage(i,0,-e.width,e.height,e.width);break;case 7:r.translate(e.width,0),r.scale(-1,1),r.rotate(270*Math.PI/180),r.drawImage(i,-e.height,0,e.height,e.width);break;default:r.drawImage(i,0,0,e.width,e.height)}return e})}function u(e){return fetch(e).then(e=>e.blob())}function l(n){return new Promise((e,t)=>{const r=new Image;r.onload=()=>e(r),r.onerror=()=>t(new Error("urltoImage(): Image failed to load, please check the image URL")),r.src=n})}var r=function(e,a,c,s){return new(c=c||Promise)(function(r,t){function n(e){try{i(s.next(e))}catch(e){t(e)}}function o(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,o)}i((s=s.apply(e,a||[])).next())})};function d(o,i={}){return r(this,void 0,void 0,function*(){if(!(o instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");if((i="object"!=typeof i?Object.assign({quality:i}):i).quality=Number(i.quality),Number.isNaN(i.quality))return o;const e=yield w(o);let t=e.split(",")[0].match(/:(.*?);/)[1],r=f.JPEG;p(i.type)&&(r=i.type,t=i.type);var n=yield v(yield m(yield y(yield g(e),Object.assign({},i)),i.quality,r),t);return n.size>o.size?o:n})}function h(d,h={}){return r(this,void 0,void 0,function*(){if(!(d instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");if((h="object"!=typeof h?Object.assign({size:h}):h).size=Number(h.size),Number.isNaN(h.size))return d;if(1024*h.size>d.size)return d;h.accuracy=Number(h.accuracy),(!h.accuracy||h.accuracy<.8||.99<h.accuracy)&&(h.accuracy=.95);const t=h.size*(2-h.accuracy)*1024,r=1024*h.size,n=h.size*h.accuracy*1024,e=yield w(d);let o=e.split(",")[0].match(/:(.*?);/)[1],i=f.JPEG;p(h.type)&&(i=h.type,o=h.type);var l=yield y(yield g(e),Object.assign({},h));let a,c=.5;const s=[null,null];for(let e=1;e<=7;e++){const h=.75*(a=yield m(l,c,i)).length;if(7===e){(t<h||n>h)&&(a=[a,...s].filter(e=>e).sort((e,t)=>Math.abs(.75*e.length-r)-Math.abs(.75*t.length-r))[0]);break}if(t<h)s[1]=a,c-=Math.pow(.5,e+1);else{if(!(n>h))break;s[0]=a,c+=Math.pow(.5,e+1)}}var u=yield v(a,o);return u.size>d.size?d:u})}}],T={},o.m=R,o.c=T,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(r,n,function(e){return t[e]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var O=o(o.s=0);function C(e,t){for(var e=e.split(","),r=e[0].match(/:(.*?);/)[1],n=atob(e[1]),o=n.length,i=new Uint8Array(o);o--;)i[o]=n.charCodeAt(o);return new File([i],t,{type:r})}function k(r){return new Promise(function(e){var t=new FileReader;t.readAsDataURL(r),t.onload=function(){e(t.result)}})}S.run=function(e,t){e=C(e.getCurrentFrameData(),"photo");return O.compressAccurately(e,24).then(k).then(function(e){return E("/face-hdphotoauth",i({photo_b64:e.split(",")[1]},t))})};var M=S;function S(){}function D(e){return new P(11008,"not support! ".concat(e))}function c(e){return new P(11e3,"piliRTC: unexpected error ".concat(e))}var P=function(n){var e=o,t=n;if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}function o(e,t){var r=n.call(this,t)||this;return r.code=e,r.error=t,r}return h(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r),o}(Error);function N(e){this.level=e}function A(){var e=new Date;function t(e){e=e.toString();return e.length<2?"0"+e:e}var r=t(e.getHours()),n=t(e.getMinutes()),o=t(e.getSeconds()),e=e.getMilliseconds();return"[".concat(r,":").concat(n,":").concat(o,".").concat(e,"]")}N.prototype.setLevel=function(e){this.level=e},N.prototype.log=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];"log"===this.level&&(e="".concat(A()," %cLOG-QNRTC"),console.info.apply(console,m([e,"color: #66ccff; font-weight: bold;"],t)))},N.prototype.debug=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];"log"!==this.level&&"debug"!==this.level||(e="".concat(A()," %cDEBUG-QNRTC"),console.info.apply(console,m([e,"color: #A28148; font-weight: bold;"],t)))},N.prototype.warning=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];"disable"!==this.level&&(e="".concat(A()," %cWARNING-QNRTC"),console.warn.apply(console,m([e,"color: #E44F44; font-weight: bold;"],t)))};var _,s=new N("log"),I=(u.prototype.releaseMediaElement=function(){s.log("Recorder release Media Element",this.mediaElement),this.mediaElement&&this.mediaElement.parentElement&&this.mediaElement.parentElement.removeChild(this.mediaElement)},u.prototype.release=function(){this.recorder&&"inactive"!==this.recorder.state&&this.recorder.stop(),this.recorder=void 0,this.recordedChunks=[],this.recordedBlob=void 0,this.recordedUrl&&(window.URL.revokeObjectURL(this.recordedUrl),this.recordedUrl=void 0),this.releaseMediaElement()},u.prototype.setMimeType=function(e){if(s.log("Recorder setMimeType, ",e),!("MediaRecorder"in window))throw D("MediaRecorder is not supported.");return!!window.MediaRecorder.isTypeSupported(e)&&(this.mimeType=e,!0)},u.prototype.start=function(e){var t=this;if(s.log("Recorder start, ",e),!("MediaRecorder"in window))throw D("MediaRecorder is not supported.");if(void 0===e||!e.audioTrack&&!e.videoTrack)throw c("Invalid parameters.");if(this.recorder&&"inactive"!==this.recorder.state)throw c("MediaRecorder is active, cannot start again.");this.release();try{var r,n=[],o=(e.audioTrack&&n.push(e.audioTrack.getMediaStreamTrack()),e.videoTrack&&n.push(e.videoTrack.getMediaStreamTrack()),new MediaStream(n)),i=window;this.mimeType?(r={mimeType:this.mimeType},this.recorder=new i.MediaRecorder(o,r)):this.recorder=new i.MediaRecorder(o),this.recorder.ondataavailable=function(e){s.debug("Recorder data, ",e.data),t.recordedChunks.push(e.data)},this.recorder.start(u.recorderTimeslice)}catch(e){throw c("MediaRecoder start error: "+e.message)}},u.prototype.pause=function(){if(s.log("Recorder pause"),!this.recorder)throw c("No MediaRecorder, please try to start first.");if("recording"!==this.recorder.state)throw c("MediaRecorder is not in recording state, cannot do pause.");this.recorder.pause()},u.prototype.resume=function(){if(s.log("Recorder resume"),!this.recorder)throw c("No MediaRecorder, please try to start first.");if("paused"!==this.recorder.state)throw c("MediaRecorder is not in paused state, cannot do resume.");this.recorder.resume()},u.prototype.stop=function(){if(s.log("Recorder stop, ",this.recordedChunks),!this.recorder)throw c("No MediaRecorder, please try to start first.");if("inactive"===this.recorder.state)throw c("MediaRecorder is in inactive state, cannot do stop.");try{var e;return this.recorder.stop(),this.mimeType?(e={type:this.mimeType},this.recordedBlob=new Blob(this.recordedChunks,e)):this.recordedBlob=new Blob(this.recordedChunks),this.recordedUrl=window.URL.createObjectURL(this.recordedBlob),this.recordedBlob}catch(e){throw c("MediaRecorder stop error: "+e.message)}},u.prototype.play=function(e,t){if(s.log("Recorder play, ",e,t=void 0===t?!0:t),!this.recordedUrl)throw c("No recorded data, please start record first.");this.releaseMediaElement();var n=document.createElement("video");return n.style.width="100%",n.style.height="100%",n.style.objectFit="contain",n.controls=!0,n.muted=t,n.className="qnrtc-recorder-video-player",n.setAttribute("playsinline",!0),n.autoplay=!0,n.src=this.recordedUrl,e.appendChild(n),this.mediaElement=n,new Promise(function(e,t){var r;try{r=n.play()}catch(e){t(e)}r?r.then(e).catch(function(e){t(e);try{throw c("MediaRecoder play error: "+e.message)}catch(e){}}):e()})},u.prototype.download=function(e){if(s.log("Recorder download, "+e),!this.recordedUrl)throw c("No recorded data, please start record first.");var t=document.createElement("a");t.style.display="none",t.href=this.recordedUrl,t.download=e,document.body.appendChild(t),t.click(),setTimeout(function(){document.body.removeChild(t)},100)},u.recorderTimeslice=200,u);function u(){this.recordedChunks=[]}(j=_=_||{})[j.Mp4=1]="Mp4",j[j.H264=2]="H264";x.start=function(e,t){var r,n=new this,o=((r={})[_.Mp4]="video/mp4",r[_.H264]="video/webm;codecs=h264",new I);return o.setMimeType(r[n.video_type]),n.recorder=o,n.recorder.start({videoTrack:e}),n.params=t,n},x.prototype.commit=function(){return f(this,void 0,void 0,function(){var t,r;return p(this,function(e){switch(e.label){case 0:return t=this.recorder.stop(),[4,(o=t,new Promise(function(t,r){var n=new FileReader;n.onload=function(e){t(e.target.result+"")},n.onerror=function(e){r("Failed to read file!\n\n"+n.error)},n.readAsDataURL(o)}))];case 1:return t=e.sent(),r="base64,",r=t.indexOf(r)+r.length,r=t.slice(r),[2,E("/face-actlive",i({video_b64:r},this.params))]}var o})})};var L=x;function x(){}F.start=function(e,t,r){var n=new this;return n.faceActionLiveDetector=L.start(e,t),n.authoritativeFaceParams=r,n.videoTrack=e,n},F.prototype.commit=function(){return Promise.all([this.faceActionLiveDetector.commit(),M.run(this.videoTrack,this.authoritativeFaceParams)]).then(function(e){return{faceActionResult:e[0],authoritativeFaceResult:e[1]}})};var j=F;function F(){}B.run=function(e,t,r){e=e.getCurrentFrameData();return E("/face-compare",i({data_uri_a:e,data_uri_b:t},r))};var U=B;function B(){}z.run=function(e,t){e=e.getCurrentFrameData();return E("/face-detect",i({image_b64:e.replace("data:image/png;base64,","")},t))};var G=z;function z(){}J.start=function(t,e){var e=e||15,r=new this;return r.frameRate=e,r.videoData=[],r.timer=setInterval(function(){var e=t.getCurrentFrameData().replace("data:image/png;base64,","");r.videoData.push({image:e})},1e3/e),r},J.prototype.commit=function(){return f(this,void 0,void 0,function(){return p(this,function(e){return clearInterval(this.timer),[2,E("/face-flashlive",{video_data:this.videoData})]})})};var Q=J;function J(){}q.run=function(e,t){e=e.getCurrentFrameData();return E("/ocr-idcard",i({image:e.replace("data:image/png;base64,","")},t))};var W=q;function q(){}K.run=function(e){return E("/general-ocr",{"data.uri":"data:application/octet-stream;base64,"+e.getCurrentFrameData().split(",")[1]})};var H,V,Y=K;function K(){}(n=H=H||{}).Male1="male1",n.Male2="male2",n.Female3="female3",n.Male4="male4",n.Female5="female5",n.Female6="female6",n.Kefu1="kefu1",n.Girl1="girl1",(n=V=V||{}).Wav="wav",n.Pcm="pcm",n.Mp3="mp3";X.run=function(e){return E("/voice-tts",i({speaker:H.Kefu1,audio_encoding:V.Wav,sample_rate:16e3,volume:50,speed:0},e))};var n=X;function X(){}e.QNAudioToTextAnalyzer=t,e.QNAuthoritativeFaceComparer=M,e.QNAuthorityActionFaceComparer=j,e.QNFaceActionLive=L,e.QNFaceComparer=U,e.QNFaceDetector=G,e.QNFaceFlashLiveDetector=Q,e.QNIDCardDetector=W,e.QNMediaRecorder=I,e.QNOCRDetector=Y,e.QNRtcAiManager=l,e.QNTextToSpeakAnalyzer=n,e.blobToBase64=k,e.compress=function(a,c){return new Promise(function(o){var i=new Image;i.src=a,i.onload=function(){var e,t,r=c.maxWidth,n=c.maxHeight;i.width*i.height>=r*n?(e=document.createElement("canvas"),r=Math.max(i.width/r,i.height/n),n=i.width/r,r=i.height/r,e.setAttribute("width",n+""),e.setAttribute("height",r+""),null!==(t=e.getContext("2d"))&&void 0!==t&&t.drawImage(i,0,0,n,r),t=e.toDataURL("image/png"),o(t)):o(a)}})},e.dataURLToFile=C,e.version="4.0.0",Object.defineProperty(e,"__esModule",{value:!0})});
